<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Marketing Suite - Standalone</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@300;400;500;600;700&display.swap" rel="stylesheet">
    <style>
        body { font-family: 'Be Vietnam Pro', sans-serif; }
        .view { display: none; }
        .view.active { display: block; }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #3b82f6; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .idea-card, .post-card { transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out; }
        .idea-card:hover, .post-card:hover { transform: translateY(-5px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
        .generated-image { width: 100%; height: 250px; object-fit: cover; }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div id="app-container" class="w-full min-h-screen flex flex-col">
        <!-- Header -->
        <header class="bg-white shadow-md w-full z-10">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <div class="flex items-center">
                        <i class="fas fa-rocket text-3xl text-blue-600"></i>
                        <h1 class="text-2xl font-bold ml-3 text-gray-800">AI Marketing Suite</h1>
                    </div>
                    <nav class="flex items-center space-x-2 rounded-lg bg-gray-200 p-1">
                        <button data-view="planner" class="nav-btn bg-white text-blue-600 px-4 py-1.5 rounded-md font-semibold shadow-sm transition">
                            <i class="fas fa-lightbulb mr-2"></i>Lên Kế Hoạch
                        </button>
                        <button data-view="creator" class="nav-btn bg-transparent text-gray-600 px-4 py-1.5 rounded-md font-semibold transition">
                            <i class="fas fa-pen-nib mr-2"></i>Tạo Bài Viết
                        </button>
                    </nav>
                </div>
            </div>
        </header>

        <main class="flex-grow container mx-auto p-4 sm:p-6 lg:p-8">
            <!-- Planner View -->
            <div id="planner-view" class="view active">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-1 bg-white p-6 rounded-xl shadow-lg h-fit">
                        <h2 class="text-2xl font-bold mb-4 text-gray-700">1. Nhập Chủ Đề</h2>
                        <form id="idea-form" class="space-y-4">
                            <textarea id="idea-keywords" placeholder="Nhập từ khóa hoặc chủ đề chính...\nVD: Nước hoa cho mùa hè" class="w-full p-3 border border-gray-300 rounded-lg h-28" required></textarea>
                            <button type="submit" id="generate-ideas-btn" class="w-full bg-blue-600 text-white font-bold py-3 rounded-lg hover:bg-blue-700 transition flex items-center justify-center text-lg">
                                <span id="generate-ideas-btn-text"><i class="fas fa-magic mr-2"></i>Tạo Ý Tưởng</span>
                                <div id="generate-ideas-loader" class="loader w-6 h-6 border-t-white hidden"></div>
                            </button>
                        </form>
                    </div>
                    <div class="lg:col-span-2">
                         <h2 class="text-2xl font-bold mb-4 text-gray-700">2. Danh Sách Ý Tưởng</h2>
                        <div id="ideas-results-container" class="space-y-6">
                            <div id="ideas-placeholder" class="text-center text-gray-500 py-20 bg-white rounded-xl shadow-lg">
                                <i class="fas fa-wand-magic-sparkles text-5xl mb-4 text-blue-400"></i>
                                <h3 class="text-2xl font-bold">Ý tưởng của bạn sẽ hiện ở đây</h3>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Creator View -->
            <div id="creator-view" class="view">
                 <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-1 bg-white p-6 rounded-xl shadow-lg h-fit">
                        <h2 class="text-2xl font-bold mb-4 text-gray-700">1. Nhập Yêu Cầu</h2>
                        <form id="post-form" class="space-y-4">
                            <textarea id="post-keywords" placeholder="Nhập chủ đề hoặc dán ý tưởng từ kế hoạch vào đây..." class="w-full p-3 border border-gray-300 rounded-lg h-28" required></textarea>
                            <div>
                                <label class="font-medium">Số lượng ảnh:</label>
                                <div class="flex items-center space-x-4 mt-2">
                                    <label class="flex items-center"><input type="radio" name="image-count" value="1" class="mr-1" checked> 1</label>
                                    <label class="flex items-center"><input type="radio" name="image-count" value="2" class="mr-1"> 2</label>
                                    <label class="flex items-center"><input type="radio" name="image-count" value="3" class="mr-1"> 3</label>
                                    <label class="flex items-center"><input type="radio" name="image-count" value="4" class="mr-1"> 4</label>
                                </div>
                            </div>
                            <button type="submit" id="generate-post-btn" class="w-full bg-purple-600 text-white font-bold py-3 rounded-lg hover:bg-purple-700 transition flex items-center justify-center text-lg">
                                <span id="generate-post-btn-text"><i class="fas fa-pen-nib mr-2"></i>Tạo Bài Viết & Hình Ảnh</span>
                                <div id="generate-post-loader" class="loader w-6 h-6 border-t-white hidden"></div>
                            </button>
                        </form>
                    </div>
                    <div class="lg:col-span-2">
                        <h2 class="text-2xl font-bold mb-4 text-gray-700">2. Kết Quả</h2>
                        <div id="post-result-container">
                            <div id="post-placeholder" class="text-center text-gray-500 py-20 bg-white rounded-xl shadow-lg">
                                <i class="fas fa-file-alt text-5xl mb-4 text-purple-400"></i>
                                <h3 class="text-2xl font-bold">Bài viết hoàn chỉnh sẽ hiện ở đây</h3>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Message Box -->
    <div id="message-box" class="hidden fixed bottom-5 right-5 text-white py-2 px-4 rounded-lg shadow-xl transition-opacity duration-300"></div>

    <script type="module">
        // --- DOM Elements ---
        const navButtons = document.querySelectorAll('.nav-btn');
        const views = document.querySelectorAll('.view');
        const messageBox = document.getElementById('message-box');

        // Planner View
        const ideaForm = document.getElementById('idea-form');
        const ideaKeywordsInput = document.getElementById('idea-keywords');
        const generateIdeasBtn = document.getElementById('generate-ideas-btn');
        const generateIdeasBtnText = document.getElementById('generate-ideas-btn-text');
        const generateIdeasLoader = document.getElementById('generate-ideas-loader');
        const ideasResultsContainer = document.getElementById('ideas-results-container');
        const ideasPlaceholder = document.getElementById('ideas-placeholder');

        // Creator View
        const postForm = document.getElementById('post-form');
        const postKeywordsInput = document.getElementById('post-keywords');
        const generatePostBtn = document.getElementById('generate-post-btn');
        const generatePostBtnText = document.getElementById('generate-post-btn-text');
        const generatePostLoader = document.getElementById('generate-post-loader');
        const postResultContainer = document.getElementById('post-result-container');
        const postPlaceholder = document.getElementById('post-placeholder');

        const API_KEY = "AIzaSyC1YDiCG_pnAXsWEd3Vh_FIN2zbyAwLcCQ";

        // --- UI Functions ---
        function switchView(viewName) {
            views.forEach(v => v.classList.remove('active'));
            document.getElementById(`${viewName}-view`).classList.add('active');
            navButtons.forEach(b => {
                const isSelected = b.dataset.view === viewName;
                b.classList.toggle('bg-white', isSelected);
                b.classList.toggle('text-blue-600', isSelected);
                b.classList.toggle('shadow-sm', isSelected);
                b.classList.toggle('bg-transparent', !isSelected);
                b.classList.toggle('text-gray-600', !isSelected);
            });
        }

        function showMessage(message, type = 'success') {
            messageBox.textContent = message;
            messageBox.className = `fixed bottom-5 right-5 text-white py-2 px-4 rounded-lg shadow-xl transition-opacity duration-300 ${type === 'success' ? 'bg-green-500' : 'bg-red-500'}`;
            messageBox.classList.remove('hidden');
            setTimeout(() => messageBox.classList.add('hidden'), 3000);
        }

        function copyToClipboard(text, button) {
            navigator.clipboard.writeText(text).then(() => {
                const originalHTML = button.innerHTML;
                button.innerHTML = '<i class="fas fa-check text-green-500"></i> Đã chép';
                showMessage('Đã sao chép vào clipboard!');
                setTimeout(() => { button.innerHTML = originalHTML; }, 2000);
            }).catch(err => {
                console.error('Failed to copy: ', err);
                showMessage('Lỗi khi sao chép.', 'error');
            });
        }

        // --- Planner Module ---
        function renderIdeas(ideas) {
            ideasPlaceholder.classList.add('hidden');
            ideasResultsContainer.innerHTML = ''; 
            if (!ideas || ideas.length === 0) {
                ideasResultsContainer.innerHTML = '<p class="text-center text-gray-600 bg-white p-10 rounded-xl shadow-lg">Không thể tạo ý tưởng. Vui lòng thử lại với từ khóa khác.</p>';
                return;
            }
            ideas.forEach((idea, index) => {
                const card = document.createElement('div');
                card.className = 'idea-card bg-white p-6 rounded-xl shadow-lg';
                card.innerHTML = `
                    <h3 class="text-xl font-bold text-blue-700 mb-3">${index + 1}. ${idea.title}</h3>
                    <div class="mt-4">
                        <label class="font-semibold text-gray-600 flex items-center"><i class="fas fa-image mr-2 text-purple-500"></i>Gợi ý Prompt cho Ảnh:</label>
                        <div class="relative mt-1">
                            <p class="text-gray-800 bg-gray-100 p-3 rounded-md pr-20">${idea.image_prompt}</p>
                            <button class="copy-btn absolute top-1/2 right-2 -translate-y-1/2 bg-gray-200 text-gray-600 hover:bg-gray-300 px-2 py-1 rounded-md text-sm" data-text="${idea.image_prompt}"><i class="fas fa-copy mr-1"></i> Chép</button>
                        </div>
                    </div>
                    <div class="mt-4">
                        <label class="font-semibold text-gray-600 flex items-center"><i class="fas fa-video mr-2 text-orange-500"></i>Gợi ý Prompt cho Video:</label>
                        <div class="relative mt-1">
                            <p class="text-gray-800 bg-gray-100 p-3 rounded-md pr-20">${idea.video_prompt}</p>
                            <button class="copy-btn absolute top-1/2 right-2 -translate-y-1/2 bg-gray-200 text-gray-600 hover:bg-gray-300 px-2 py-1 rounded-md text-sm" data-text="${idea.video_prompt}"><i class="fas fa-copy mr-1"></i> Chép</button>
                        </div>
                    </div>
                `;
                ideasResultsContainer.appendChild(card);
            });
            document.querySelectorAll('.copy-btn').forEach(button => {
                button.addEventListener('click', (e) => copyToClipboard(e.currentTarget.dataset.text, e.currentTarget));
            });
        }

        async function handleGenerateIdeas(e) {
            e.preventDefault();
            const keywords = ideaKeywordsInput.value.trim();
            if (!keywords) {
                showMessage("Vui lòng nhập chủ đề.", 'error');
                return;
            }
            generateIdeasBtnText.classList.add('hidden');
            generateIdeasLoader.classList.remove('hidden');
            generateIdeasBtn.disabled = true;
            ideasPlaceholder.classList.add('hidden');
            ideasResultsContainer.innerHTML = `<div class="text-center text-gray-500 py-20 bg-white rounded-xl shadow-lg"><div class="loader mx-auto"></div><p class="mt-4 font-semibold">AI đang lên ý tưởng...</p></div>`;

            const schema = {
                type: "OBJECT",
                properties: { "ideas": { type: "ARRAY", items: { type: "OBJECT", properties: { "title": { "type": "STRING" }, "image_prompt": { "type": "STRING" }, "video_prompt": { "type": "STRING" } }, required: ["title", "image_prompt", "video_prompt"] } } },
                required: ["ideas"]
            };
            const prompt = `Tạo ra 5 ý tưởng nội dung marketing độc đáo bằng tiếng Việt dựa trên chủ đề sau: "${keywords}". Với mỗi ý tưởng, hãy cung cấp: 1. Một tiêu đề (title) thật hấp dẫn. 2. Một gợi ý chi tiết (image_prompt) bằng tiếng Anh để tạo hình ảnh AI, mô tả cảnh, màu sắc, và cảm xúc. 3. Một gợi ý chi tiết (video_prompt) bằng tiếng Anh để tạo video ngắn, mô tả các cảnh quay, chuyển động, và âm nhạc.`;
            const payload = { contents: [{ parts: [{ text: prompt }] }], generationConfig: { responseMimeType: "application/json", responseSchema: schema } };
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${API_KEY}`;
            
            try {
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) throw new Error(`API call failed with status: ${response.status}`);
                const result = await response.json();
                const jsonText = result.candidates[0].content.parts[0].text;
                const data = JSON.parse(jsonText);
                renderIdeas(data.ideas);
            } catch (error) {
                console.error('Error generating ideas:', error);
                showMessage('Không thể tạo ý tưởng. Vui lòng thử lại.', 'error');
                ideasResultsContainer.innerHTML = '';
                ideasPlaceholder.classList.remove('hidden');
            } finally {
                generateIdeasBtnText.classList.remove('hidden');
                generateIdeasLoader.classList.add('hidden');
                generateIdeasBtn.disabled = false;
            }
        }

        // --- Creator Module ---
        function renderPost(postData) {
            postPlaceholder.classList.add('hidden');
            postResultContainer.innerHTML = '';
            const card = document.createElement('div');
            card.className = 'post-card bg-white rounded-xl shadow-lg overflow-hidden';
            
            let imagesHTML = postData.images.map(url => `<img src="${url}" class="generated-image rounded-md">`).join('');

            card.innerHTML = `
                <div class="p-6">
                    <h3 class="text-2xl font-bold text-gray-800 mb-4">Bài Viết Của Bạn</h3>
                    <div class="relative">
                        <textarea class="w-full h-64 p-3 border rounded-md bg-gray-50">${postData.content}</textarea>
                        <button class="copy-btn absolute top-2 right-2 bg-gray-200 text-gray-600 hover:bg-gray-300 px-2 py-1 rounded-md text-sm" data-text="${postData.content}"><i class="fas fa-copy mr-1"></i> Chép</button>
                    </div>
                </div>
                <div class="p-6 bg-gray-50">
                     <h3 class="text-2xl font-bold text-gray-800 mb-4">Hình Ảnh Minh Họa</h3>
                     <div class="grid grid-cols-2 gap-4">${imagesHTML}</div>
                </div>
            `;
            postResultContainer.appendChild(card);
            document.querySelectorAll('.copy-btn').forEach(button => {
                button.addEventListener('click', (e) => copyToClipboard(e.currentTarget.dataset.text, e.currentTarget));
            });
        }

        async function generateText(prompt) {
            const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${API_KEY}`;
            const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
            if (!response.ok) throw new Error(`Text generation failed: ${response.status}`);
            const result = await response.json();
            if (result.candidates?.[0]?.content?.parts?.[0]?.text) return result.candidates[0].content.parts[0].text;
            throw new Error("Text generation failed: Invalid response format.");
        }

        async function generateImages(prompt, count) {
            const imagePromises = [];
            for (let i = 0; i < count; i++) {
                const payload = {
                  contents: [{ parts: [{ text: `A visually stunning marketing image about "${prompt}", high quality, professional photography, cinematic style.` }] }],
                  generationConfig: { responseModalities: ['IMAGE', 'TEXT'] },
                };
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-preview-image-generation:generateContent?key=${API_KEY}`;
                const promise = fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) })
                    .then(res => res.ok ? res.json() : Promise.reject(new Error(`Image generation failed: ${res.status}`)))
                    .then(result => {
                        const base64Data = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;
                        if (base64Data) return `data:image/png;base64,${base64Data}`;
                        throw new Error("Image generation failed: No image data.");
                    });
                imagePromises.push(promise);
            }
            return Promise.all(imagePromises);
        }

        async function handleGeneratePost(e) {
            e.preventDefault();
            const keywords = postKeywordsInput.value.trim();
            if (!keywords) {
                showMessage("Vui lòng nhập chủ đề.", 'error');
                return;
            }
            generatePostBtnText.classList.add('hidden');
            generatePostLoader.classList.remove('hidden');
            generatePostBtn.disabled = true;
            postPlaceholder.classList.add('hidden');
            postResultContainer.innerHTML = `<div class="text-center text-gray-500 py-20 bg-white rounded-xl shadow-lg"><div class="loader mx-auto"></div><p class="mt-4 font-semibold">AI đang viết bài và vẽ tranh...</p></div>`;

            try {
                const imageCount = parseInt(document.querySelector('#creator-view input[name="image-count"]:checked').value);
                const textPrompt = `Viết một bài đăng mạng xã hội hoàn chỉnh bằng tiếng Việt về chủ đề: "${keywords}". Yêu cầu: Viết thật hấp dẫn, chuyên nghiệp, có cấu trúc rõ ràng (mở bài, thân bài, kết bài), sử dụng emoji một cách tinh tế, và kết thúc bằng một lời kêu gọi hành động mạnh mẽ cùng các hashtags liên quan.`;
                const [content, images] = await Promise.all([
                    generateText(textPrompt),
                    generateImages(keywords, imageCount)
                ]);
                renderPost({ content, images });
            } catch (error) {
                console.error('Error generating post:', error);
                showMessage('Không thể tạo bài viết. Vui lòng thử lại.', 'error');
                postResultContainer.innerHTML = '';
                postPlaceholder.classList.remove('hidden');
            } finally {
                generatePostBtnText.classList.remove('hidden');
                generatePostLoader.classList.add('hidden');
                generatePostBtn.disabled = false;
            }
        }

        // --- Initial Setup ---
        navButtons.forEach(btn => btn.addEventListener('click', () => switchView(btn.dataset.view)));
        ideaForm.addEventListener('submit', handleGenerateIdeas);
        postForm.addEventListener('submit', handleGeneratePost);

    </script>
</body>
</html>
